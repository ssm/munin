#! /usr/bin/make -f

export DH_VERBOSE=1

MAKEOPTS = INSTALLDIRS=vendor

%:
	dh $@

override_dh_auto_build:
	# ./getversion reads RELEASE if it exists
	dpkg-parsechangelog | sed -n 's/^Version: //p' > RELEASE
	dh_auto_build -- $(MAKEOPTS)
	make -C doc html man

override_dh_install:
	rm -rfv debian/tmp/usr/share/man/man1
	dh_install --fail-missing

override_dh_installdocs:
	dh_installdocs
	@ # Use the packaged javascript libraries
	if [ -d debian/munin-doc ]; then \
		rm -f debian/munin-doc/usr/share/doc/munin-doc/html/_static/jquery.js; \
		ln -s /usr/share/javascript/jquery/jquery.js \
			debian/munin-doc/usr/share/doc/munin-doc/html/_static/jquery.js; \
		rm -f debian/munin-doc/usr/share/doc/munin-doc/html/_static/underscore.js; \
		ln -s /usr/share/javascript/underscore/underscore.js \
			debian/munin-doc/usr/share/doc/munin-doc/html/_static/underscore.js; \
	fi
